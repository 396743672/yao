<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.y3tu.cloud.upms.mapper.PermissionMapper">

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id
        ,
        create_by
        AS
        createBy,
        create_time
        AS
        createTime,
        del_flag
        AS
        delFlag,
        update_by
        AS
        updateBy,
        update_time
        AS
        updateTime,
        description,
        name,
        parent_id
        AS
        parentId,
        type,
        sort_order
        AS
        sortOrder,
        component,
        path,
        title,
        icon,
        level,
        button_type
        AS
        buttonType,
        status
    </sql>

    <select id="queryPage" resultType="com.y3tu.cloud.upms.model.entity.Permission">
        select
        <include refid="Base_Column_List"/>
        from permission
    </select>

    <select id="findByUserId" resultType="com.y3tu.cloud.upms.model.entity.Permission">
        SELECT DISTINCT p.id,
                        p.name,
                        p.title,
                        p.path,
                        p.icon,
                        p.type,
                        p.component,
                        p.level,
                        p.button_type as buttonType,
                        p.parent_id   as parentId,
                        p.sort_order  as sortOrder,
                        p.description,
                        p.status,
                        p.url
        FROM t_user u
                 LEFT JOIN t_user_role ur ON u.id = ur.user_id
                 LEFT JOIN t_role_permission rp ON ur.role_id = rp.role_id
                 LEFT JOIN t_permission p ON p.id = rp.permission_id
        WHERE u.id = #{userId}
          AND p.status = 0
        ORDER BY p.sort_order ASC
    </select>
</mapper>
